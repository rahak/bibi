
ドレス作成・運用ガイド　２．カスタマイズ編
================================================================================================================================

この README では、テンプレートからのカスタマイズでオリジナルのドレスを作る人に向けて、ソースフォルダに含まれる各ファイルの役目を概説します。
先に「ドレス作成・運用ガイド（１）はじめに」（01_Introduction.md）を読んでおいてください。



ドレスのソースフォルダ内の構成
--------------------------------------------------------------------------------------------------------------------------------

「はじめに」に引き続き、あたらしく作成するドレスの名前は仮に cocktail であるとしておきます。

次のファイル構成図は、_template フォルダを複製・リネームして作った cocktail フォルダ（cocktail ドレスのソースフォルダ）内から、編集対象となるファイルのみを挙げたものです。
構成図に挙がっていないファイルは、生成処理が利用するためのものなので、編集しないでください。

```
+ dev-bib/
  + i/
    + res/
      + styles/
        + wardrobe/
          + cocktail/
            - _arrows.scss
            - _help.scss
            - _icons.scss
            - _main.scss
            - _menu.scss
            - _nomble.scss
            - _notifier.scss
            - _panel.scss
            - _slider.scss
            - _spinner.scss
            - _stage.scss
            - _subpanels.scss
            - _veil.scss
            - bibi.dress.scss
```

説明と理解の双方の便宜上、上の構成図どおりのアルファベット順ではなく、次の順で説明していきます。これを目次として、順次読んでいってください。

1. 根幹となるファイル
    1. bibi.dress.scss … すべてが集約される基幹ファイル（より独自性の強いカスタマイズもここで）
2. 基本要素のスタイル
    1. _stage.scss … ビビ全体に関わるスタイル
    2. _main.scss … 本の表示部分のスタイル
3. 個別 UI のスタイル
    1. _notifier.scss … 画面上部にあらわれる **Notifier**（通知）UI のスタイル
    2. _veil.scss … 本が開かれる前に画面全体を覆っている **Veil** UI のスタイル
    3. _help.scss … UI にマウスカーソルを合わせたときに画面下部にあらわれる **Help** UI のスタイル
    4. _menu.scss … 画面上部に固定されている **Menu** UI（メニューバー）のスタイル
    5. _panel.scss … 左上アイコンから開かれる、目次・ナビゲーション・書誌情報をまとめた **Panel** UI のスタイル
    6. _subpanels.scss … メニューバーのアイコンから具体的なメニューリストとして開かれる **Subpanel** UI のスタイル
    7. _icons.scss … メニューバーと Subpanel 内のアイコンの共通スタイル
    8. _spinner.scss … 時間のかかる処理中に画面中央に表示される **Spinner** UI のスタイル
    9. _slider.scss … 画面下部（縦スクロール時は右）にあり、画面中央タップ／クリックで拡張される **Slider** UI のスタイル
    10. _nombre.scss … Slider UI の側に現れる現在の表示位置・ページ数を示す **Nombre**（ノンブル）UI のスタイル
    11. _arrows.scss … 画面左右端（縦スクロール時は上下端）にあらわれる **Arrow** UI のスタイル

なお、具体的なカスタマイズの際に重要となる、各ファイル内の個々の変数が具体的に司る内容については、各ファイル中でそれぞれの変数にコメントを添えてあるので、そちらを参照してください。




bibi.dress.scss … すべてが集約される基幹ファイル（より独自性の強いカスタマイズもここで）
--------------------------------------------------------------------------------------------------------------------------------

最終的にはすべてのソースファイルのカスタマイズ成果がこのファイルに集約され、生成結果に出力されます。

```
@import "@";
```

ファイル中にあるこの１行によって、他のソースファイルの読み込みや、それに基づく実際のスタイルの生成など、すべての処理を呼び込んでいます。

したがって、

1. この１行を消去しない限りは、基本的に自由に編集できます。
2. もし必要であれば、この１行の前で、何度も使う独自の変数やミックスインを定義しておいて、他のソースファイル内で使うこともできます。
3. もし必要であれば、この１行の後に、ドレスのカバー範囲を超える内容のスタイルを自由に記述することができます。           

@import 文前後に可能な自由記述では、たとえば、@import 文で任意の Sass モジュールファイルを読み込むこともできます。
また、冒頭にある複数行コメントは、削除しても構いませんし、ドレス作成者の情報などを記述するために使うこともできます。

　＊

なお、この「唯一の @import 文ですべてのスタイルを生成する。したがってその前後に自由記述ができる」という仕様は、将来のバージョンにわたって堅持するつもりでいます。
つまり、ドレスに予め用意された仕組みを超えてスタイルを拡張したい場合は、上のルールに沿って、この bibi.dress.scss 内に記述したり、ここを起点に @import したりして編集するのが安全です。そうしておけば、ドレス機能のバージョンアップ時にも各ドレスをそれに併せて更新しやすい状態が維持されます。




_stage.scss … ビビ全体に関わるスタイル
--------------------------------------------------------------------------------------------------------------------------------

ビビ全体に関わるスタイルが定義されています（UI の font-family など）。

あわせて、他の複数のソースファイルで使用される共通の値もここに記述されています。
たとえば、ビビの画面下にあるスライダー UI の高さは、スライダーについてまとめた _slider.scss ではなく、この _stage.scss で定義されています。
これは、スライダーの高さが他の UI のレイアウト（＝スタイル定義）にも影響を与えるためです。
他にボタンアイコンの大きさなども含まれていますが、同様の理由です。

　＊

なお、このファイルに定義された“複数のソースファイルで使用される共通の値”というのは、あくまでも“ドレスとして明示的にカスタマイズを解放してある値のうち”、ということです。
ドレス作成者が自身のドレス内の複数ファイルで使いたい任意の新しい変数は、前項 bibi.dress.scss ファイルについての説明でも触れたとおり、この _stage.scss ではなく、bibi.dress.scss ファイル内の @import 文の前に追加する（あるいはそこから別モジュールを @import する）ことを推奨します。

たとえば、今後ドレス機能自体のアップデートがあった場合、テンプレート（_dress-template フォルダ）中の各ソースファイルに用意されたカスタマイズ可能な変数は、増えたり減ったりする可能性があります。
そうした場合も、独自拡張を bibi.dress.scss に集約しておけば、この _stage.scss や他の各ソースファイルを新しいバージョンのテンプレートに基づく内容へと更新しやすいはずです。

もしドレス機能のバージョンアップで新しく設定可能な変数が増え、そのバージョンのビビで古いドレスを生成処理にかけた場合も、あらたな変数による設定値にデフォルトが使用されるだけで、問題なくドレスファイルが生成される見込みです。そしてもちろん、新規追加変数の値は、テンプレートに倣ってドレスソースフォルダ内に追加定義すればカスタマイズ可能となります。

また、変数が減る場合というのは、そこがカスタマイズ可能ではなくなったり、カスタマイズ対象がなくなったりする場合に考えられます。その場合も、仮になくなった変数の定義がドレスに残っていたとしても、生成処理で無視されるだけで、エラーなどは生じません。




_main.scss … 本の表示部分のスタイル
--------------------------------------------------------------------------------------------------------------------------------

書籍を表示する部分全体の背景色や、読み込み中アイテムの背景色や「Loading...」表示などをカスタマイズできます。

「Loading...」文字列は疑似要素の content で実装されており、これは画像に変えたりすることも可能です。




_notifier.scss … 画面上部にあらわれる **Notifier**（通知）UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

最初のローディング時に進捗を表示したり、表示設定の変更時やエラー発生時に通知を行う Notifier の文字色や背景色をカスタマイズできます。




_veil.scss … 本が開かれる前に画面全体を覆っている **Veil** UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

読み込み中や、埋め込み状態などでクリック／タップで開かれるのを待っているとき、あるいはドラッグ＆ドロップを待機しているとき、または非対応環境に表示するメッセージなど、本が開かれる前の段階で画面全体を覆っているのが Veil UI です。その表示をカスタマイズできます。

自動的に本が開かれる設定で使用している場合、Veil は、EPUB に表紙が定義されてあればそれを、なければ簡単な書誌情報を表示してローディング中の画面を覆いますが、そのごく短い間に１度だけ現れます。この背景色などがカスタマイズできます（EPUB に表紙が定義されていない場合に書誌情報に添えて表示されるアイコンは、現在のところ変更できません）。

また、埋め込み状態など、設定によってクリック／タップで開かれるのを待っている場合は、動画再生アイコンに似たアイコンを表示しています。このアイコンなどもカスタマイズできます。

設定によってドラッグ＆ドロップによるローカル EPUB ファイルのオープンを許可している場合は、枠線やアイコンが表示されます。この線の色などもカスタマイズ可能です（アイコンは、現在の所変更できません）。




_help.scss … UI にマウスカーソルを合わせたときに画面下部にあらわれる **Help** UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

メニュー項目にカーソルを合わせたときなどに画面下部に現れる Help UI の、文字色や背景色をカスタマイズできます。
なお、Help UI を使用するかどうかをプリセットファイルで選択可能で、その設定で Help UI 自体を消すことも可能です。




_menu.scss … 画面上部に固定されている **Menu** UI（メニューバー）のスタイル
--------------------------------------------------------------------------------------------------------------------------------

上部メニューバーは様々な状況に応じて背景色や透明度が変化しますが、これがカスタマイズ可能です。
カスタマイズする場合は、UI としての挙動の一貫性を失わせて閲覧者を混乱させないよう、充分に注意してください。

メニューバーの高さは、他の様々な UI のレイアウトに影響するため、前述の _stage.scss 内で設定するようになっています。
また、アイコン類のスタイルは、他の場所で使われるアイコンのデザインと一貫性を保つため、後述の _icons.scss で設定するようになっています。

_icons.scss 内では、アイコンの画像として、デフォルトのデザインが利用しているのとは異なるアイコンフォントを利用したり、フォントではなくそれぞれ任意の画像に変更するような深いカスタマイズも可能です。




_panel.scss … 左上アイコンから開かれる、目次・ナビゲーション・書誌情報をまとめた **Panel** UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

Panel 内にある目次の文字色や、表紙画像の側の区切り線の色などがカスタマイズできます。

なお、書字方向を横書きに固定するなどの制御は、プリセットファイルで可能です。




_subpanels.scss … メニューバーのアイコンから具体的なメニューリストとして開かれる **Subpanel** UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

メニュー各項目の文字色などが、閲覧者による設定のオン／オフなどの状況ごとにカスタマイズ可能です。
アイコンや文字の色は、UI としての統一性が求められる箇所なので、デフォルトでは、最初に設定できるキーカラーを利用するように記述してあります。
文字色などはキーカラー設定を無視して個別に定義し直すこともできますが、その場合はアイコンのデザインとの不統一が閲覧者を混乱させないよう、充分に注意してください。

Subpanel 内のアイコンのスタイルも、メニューバー内のアイコンと同様、デザインの一貫性を保つために、次項の _icons.scss 内に記述されています。
_icons.scss 内でも、デフォルトでは、ここで設定するキーカラーを参照するようにしてあります。




_icons.scss … メニューバーと Subpanel 内のアイコンの共通スタイル
--------------------------------------------------------------------------------------------------------------------------------

アプリケーションの UI には、利用者が違和感なく利用でき、納得あるフィードバックを得られるような、一貫したマナーに基づくインタラクションが求められます。
とくに、閲覧者の捜査結果を反映して外見を変えることも多いボタンや、そこにあしらわれるアイコンでは、この点が非常に重要です。

したがって、アイコンの現れる場所はメニュー内であったりサブパネル内であったりと個別に異なりますが、基本的にはここで一括で指定するようになっています。
ただし、アイコンの基本的な大きさはさらに広範囲に影響を与えるため、ここではなく、前述の _stage.scss で定義されています。

変数値を変更するだけで色の変更や大きさなどの微調整が行えるほか、デフォルトでは Material Icons アイコンフォントを利用しているデザインを別のアイコンフォントにしたり、あるいはフォントを使用せずに任意の画像に変更したりといった深いカスタマイズにも対応しています（それぞれ、変数ではなく、変更可能な部分に絞った mixin を用意してあります）。

Subpanel 内のアイコンは、閲覧者による操作状況に応じて文字色などと統一した振る舞いが求められるため、そうしたカスタマイズは前述の _subpanels.scss 内で行えるようになっています。
双方の設定を行き来して、矛盾のないデザインとなるよう注意してください。




_spinner.scss … 時間のかかる処理中に画面中央に表示される **Spinner** UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

やや特殊な内容になっています。

大きな mixin 内の CSS を自由に編集可能とすることで、たとえば１枚のアニメーション GIF 画像にしてしまうなど、デフォルトのデザインにとらわない自由なデザインのスピナーが利用できるようにしました。

ビビのデフォルトでは混み入った CSS で特殊なスピナーを構築してあり、それがテンプレート中の mixin の内容ですが、この特殊なスピナー各部の色や形状をカスタマイズできるようにするよりも、独自のスピナーに置き換えられるほうが需要に合うだろう、という判断からです。

たとえば独自のアニメーション GIF 画像に置き換える場合は、span 要素の display を none にして、:before, :after 各疑似要素は用いず、mixin 直下に背景画像でアニメーション GIF を使用するなどの方法が考えられます（:before 疑似要素の content に画像を入れる方法も考えられます）。

そうした場合は @keyframes の定義は不要になりますので、コメントアウトしてください（削除しても構いません）。




_slider.scss … 画面下部（縦スクロール時は右）にあり、画面中央タップ／クリックで拡張される **Slider** UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

Slider は、平常時はスクロールバーを模しており、画面中央のタップ／クリック時には大きくなってデザインを変えます。
スクロールバーを模した状態の各パーツの色は、Panel や Subpanel 内にも現れる可能性があるスクロールバーとのデザイン一貫性を保つため、_stage.scss で行うようになっています。

_slider.scss では、主に大きくなったときの各パーツのサイズや色がカスタマイズ可能です。
ただし、大きくなったときの全体の太さについては、他の UI のレイアウトにも影響するため、_stage.scss で設定します。

Slider は閲覧者の頻繁な操作が想定される繊細な UI なので、様々な操作に矛盾なく応えられるデザインになるよう、とくに細かく注意を払ってください。




_nombre.scss … Slider UI の側に現れる現在の表示位置・ページ数を示す **Nombre**（ノンブル）UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

背景色と文字色のカスタマイズが可能です。

なお、画面中央をタップしたとき（Slider が大きくなっているとき）以外は表示しない、あるいはそもそも Nombre を利用しない、といった制御はプリセットファイルで可能です。




_arrows.scss … 画面左右端（縦スクロール時は上下端）にあらわれる **Arrow** UI のスタイル
--------------------------------------------------------------------------------------------------------------------------------

アイコンの色や大きさを、閲覧者の操作状況ごとにカスタマイズできます。

Arrow の各アイコンも、他のアイコン系要素同様、デフォルトのアイコンフォント利用をやめて画像にするなどの深いカスタマイズが可能です。



